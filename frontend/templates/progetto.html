<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>{{ progetto_nome }} - QTasks</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="project-details-container">
        <!-- Back to dashboard -->
        <nav class="back-nav">
            <a href="/">‚Üê Back to dashboard</a>
        </nav>

        <h1 class="project-title">{{ progetto_nome }}</h1>

        <div class="dashboard-project-split">
            <!-- Colonna sinistra: Creazione task -->
            <div class="project-tasks-create-panel">
                <h2 class="section-title">Create new task</h2>
                <form method="post" action="/crea_task" class="create-task-form">
                    <input type="hidden" name="progetto_id" value="{{ progetto_id }}">
                    
                    <label for="titolo">Task name</label>
                    <input type="text" name="titolo" placeholder="e.g. Implementazione grafici" required>

                    <label for="stato">Status</label>
                    <select name="stato">
                        <option value="da_fare">Da fare</option>
                        <option value="in_corso">In corso</option>
                        <option value="completato">Completato</option>
                    </select>

                    <label for="assegnato_a">Assignee</label>
                    <select name="assegnato_a">
                        <option value="">Nessuno</option>
                        {% for membro in membri_progetto %}
                            <option value="{{ membro.id }}">{{ membro.nome }}</option>
                        {% endfor %}
                    </select>
                    
                    <label for="scadenza">Due date</label>
                    <input type="date" name="scadenza">

                    <label for="parent_id">Sub-task of</label>
                    <select name="parent_id">
                        <option value="">Nessuno</option>
                        {% for task in tasks %}
                            <option value="{{ task.id }}">{{ task.titolo }}</option>
                        {% endfor %}
                    </select>
                    
                    <button type="submit" class="btn-accent">Crea Task</button>
                </form>
            </div>

            <!-- Colonna destra: Elenco task tabellare -->
            <div class="project-tasks-list-panel">
                <h2 class="section-title">Task del progetto</h2>
                <table class="table-tasks">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Assignee</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td>
                                {{ task.titolo }}
                                <span class="task-status">({{ task.stato }})</span>
                                {% if task.descrizione %}
                                    <br><span class="task-description">{{ task.descrizione }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if task.assegnato_a %}
                                    {% for membro in membri_progetto %}
                                        {% if membro.id == task.assegnato_a %}
                                            {{ membro.nome }}
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    Nessuno
                                {% endif %}
                            </td>
                            <td>
                                {% if task.scadenza %}
                                    {{ task.scadenza }}
                                {% endif %}
                            </td>
                            <td>
                                <a href="/modifica_task/{{ task.id }}?progetto_id={{ progetto_id }}" class="icon-edit" title="Modifica">&#9998;</a>
                                <form method="post" action="/elimina_task" style="display:inline;">
                                    <input type="hidden" name="task_id" value="{{ task.id }}">
                                    <input type="hidden" name="progetto_id" value="{{ progetto_id }}">
                                    <button type="submit" class="icon-delete" title="Elimina" onclick="return confirm('Sei sicuro di voler eliminare questo task e tutti i suoi subtasks?');">&#128465;</button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4">Nessun task trovato</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
